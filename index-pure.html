<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ë≤ùÊûú vs ÁîúÁîúÂúàËæ®Ë≠ò</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .app {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .app-container {
      width: 100%;
      max-width: 500px;
      position: relative;
      z-index: 1;
    }

    .dots-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
    }

    .dot {
      position: absolute;
      width: 8px;
      height: 8px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      animation: float 4s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0) scale(1);
        opacity: 0.3;
      }
      50% {
        transform: translateY(-20px) scale(1.2);
        opacity: 0.6;
      }
    }

    .app-header {
      text-align: center;
      margin-bottom: 40px;
      color: white;
    }

    .title-circle {
      display: inline-block;
      padding: 20px 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
    }

    .title-circle h1 {
      font-size: 28px;
      font-weight: 700;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .subtitle {
      font-size: 16px;
      opacity: 0.9;
      font-weight: 300;
    }

    .mode-selector {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 30px;
    }

    .mode-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }

    .camera-circle {
      background: rgba(255, 255, 255, 0.25);
      border: 3px solid rgba(255, 255, 255, 0.5);
    }

    .upload-circle {
      background: rgba(255, 255, 255, 0.25);
      border: 3px solid rgba(255, 255, 255, 0.5);
    }

    .mode-circle:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    }

    .mode-icon {
      font-size: 48px;
      margin-bottom: 8px;
    }

    .mode-circle span {
      color: white;
      font-size: 16px;
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    .result-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
    }

    .image-preview-circle {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      overflow: hidden;
      border: 6px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .image-preview-circle::before {
      content: '';
      position: absolute;
      inset: -6px;
      border-radius: 50%;
      padding: 6px;
      background: linear-gradient(45deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      animation: rotate 3s linear infinite;
    }

    @keyframes rotate {
      to {
        transform: rotate(360deg);
      }
    }

    .image-preview-circle img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    .loading-circle {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      color: white;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .reset-button {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 25px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      font-weight: 600;
    }

    .reset-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .reset-circle {
      display: inline-block;
      width: 24px;
      height: 24px;
      line-height: 24px;
      text-align: center;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      font-size: 18px;
    }

    /* Image Capture Styles */
    .image-capture {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
    }

    .camera-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
    }

    .camera-circle-frame {
      width: 350px;
      height: 350px;
      border-radius: 50%;
      overflow: hidden;
      border: 8px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      background: #000;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .camera-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1);
    }

    .error-message {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      padding: 30px;
      color: white;
      text-align: center;
    }

    .error-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
    }

    .cancel-button {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 20px;
      color: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .cancel-button:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .capture-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px;
      width: 100%;
    }

    .control-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .cancel-btn {
      background: rgba(255, 100, 100, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.5);
      color: white;
      font-size: 24px;
      font-weight: bold;
    }

    .cancel-btn:hover {
      background: rgba(255, 100, 100, 0.5);
      transform: scale(1.1);
    }

    .capture-btn {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.3);
      border: 4px solid rgba(255, 255, 255, 0.6);
      position: relative;
    }

    .capture-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .capture-inner {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .placeholder {
      visibility: hidden;
    }

    /* Image Upload Styles */
    .image-upload {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
    }

    .upload-area-circle {
      width: 350px;
      height: 350px;
      border-radius: 50%;
      border: 4px dashed rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .upload-area-circle::before {
      content: '';
      position: absolute;
      inset: -4px;
      border-radius: 50%;
      padding: 4px;
      background: linear-gradient(45deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .upload-area-circle:hover {
      border-color: rgba(255, 255, 255, 0.8);
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.05);
    }

    .upload-area-circle:hover::before {
      opacity: 1;
    }

    .upload-area-circle.dragover {
      border-color: rgba(255, 255, 255, 1);
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
    }

    .upload-icon-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
    }

    .upload-icon {
      font-size: 50px;
    }

    .upload-text {
      color: white;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    .upload-hint {
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    .cancel-upload-button {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 25px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      font-weight: 600;
    }

    .cancel-upload-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .cancel-circle {
      display: inline-block;
      width: 24px;
      height: 24px;
      line-height: 24px;
      text-align: center;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      font-size: 18px;
    }

    /* Result Display Styles */
    .result-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 25px;
      width: 100%;
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: 4px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
      position: relative;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    .bagel-result {
      background: rgba(255, 200, 87, 0.3);
      border-color: rgba(255, 200, 87, 0.6);
    }

    .donut-result {
      background: rgba(255, 150, 200, 0.3);
      border-color: rgba(255, 150, 200, 0.6);
    }

    .result-error-circle {
      background: rgba(255, 100, 100, 0.3);
      border-color: rgba(255, 100, 100, 0.6);
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .result-emoji {
      font-size: 80px;
      animation: bounce 1s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    .result-info {
      text-align: center;
      color: white;
      width: 100%;
    }

    .result-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 25px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .confidence-bar {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .confidence-label {
      font-size: 16px;
      opacity: 0.9;
      font-weight: 500;
    }

    .confidence-circle-container {
      position: relative;
      width: 120px;
      height: 120px;
    }

    .confidence-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 4px solid rgba(255, 255, 255, 0.2);
      position: relative;
    }

    .confidence-circle::before {
      content: '';
      position: absolute;
      inset: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    .confidence-circle span {
      position: relative;
      z-index: 1;
      font-size: 24px;
      font-weight: 700;
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    .result-details {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 16px;
      opacity: 0.9;
      padding: 15px 25px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 25px;
      backdrop-filter: blur(10px);
    }

    .detail-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      animation: blink 2s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.3;
      }
    }

    .error-result {
      color: white;
    }

    .result-message {
      font-size: 18px;
      padding: 20px;
      background: rgba(255, 100, 100, 0.2);
      border-radius: 15px;
      border: 2px solid rgba(255, 100, 100, 0.4);
    }

    .hidden {
      display: none !important;
    }

    input[type="file"] {
      display: none;
    }

    @media (max-width: 600px) {
      .mode-selector {
        gap: 20px;
      }

      .mode-circle {
        width: 100px;
        height: 100px;
      }

      .mode-icon {
        font-size: 40px;
      }

      .image-preview-circle,
      .camera-circle-frame,
      .upload-area-circle {
        width: 280px;
        height: 280px;
      }

      .title-circle h1 {
        font-size: 24px;
      }

      .result-circle {
        width: 120px;
        height: 120px;
      }

      .result-emoji {
        font-size: 60px;
      }

      .result-title {
        font-size: 26px;
      }

      .confidence-circle-container,
      .confidence-circle {
        width: 100px;
        height: 100px;
      }

      .confidence-circle span {
        font-size: 20px;
      }

      .capture-controls {
        gap: 30px;
      }

      .control-circle {
        width: 50px;
        height: 50px;
      }

      .capture-btn {
        width: 70px;
        height: 70px;
      }

      .capture-inner {
        width: 50px;
        height: 50px;
      }

      .upload-icon-circle {
        width: 80px;
        height: 80px;
      }

      .upload-icon {
        font-size: 40px;
      }

      .upload-text {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-container">
      <!-- Ë£ùÈ£æÊÄßÂúìÈªûËÉåÊôØ -->
      <div class="dots-background" id="dotsBackground"></div>

      <header class="app-header">
        <div class="title-circle">
          <h1>üç© Ë≤ùÊûú vs ÁîúÁîúÂúà</h1>
        </div>
        <p class="subtitle">ÂúñÂÉèËæ®Ë≠òÁ≥ªÁµ±</p>
      </header>

      <!-- Ê®°ÂºèÈÅ∏Êìá -->
      <div class="mode-selector" id="modeSelector">
        <div class="mode-circle camera-circle" onclick="openCamera()">
          <div class="mode-icon">üì∑</div>
          <span>ÊãçÁÖß</span>
        </div>
        <div class="mode-circle upload-circle" onclick="openUpload()">
          <div class="mode-icon">üìÅ</div>
          <span>‰∏äÂÇ≥</span>
        </div>
      </div>

      <!-- ÊãçÁÖßÁïåÈù¢ -->
      <div class="image-capture hidden" id="cameraSection">
        <div class="camera-container">
          <div class="camera-circle-frame" id="cameraFrame">
            <video id="videoElement" class="camera-video" autoplay playsinline></video>
            <canvas id="canvasElement" style="display: none;"></canvas>
          </div>
          <div class="capture-controls">
            <button class="control-circle cancel-btn" onclick="cancelCamera()">‚úï</button>
            <button class="control-circle capture-btn" onclick="capturePhoto()">
              <div class="capture-inner"></div>
            </button>
            <div class="control-circle placeholder"></div>
          </div>
        </div>
      </div>

      <!-- ‰∏äÂÇ≥ÁïåÈù¢ -->
      <div class="image-upload hidden" id="uploadSection">
        <div 
          class="upload-area-circle" 
          id="uploadArea"
          onclick="document.getElementById('fileInput').click()"
          ondrop="handleDrop(event)"
          ondragover="handleDragOver(event)"
          ondragleave="handleDragLeave(event)"
        >
          <div class="upload-icon-circle">
            <div class="upload-icon">üìÅ</div>
          </div>
          <p class="upload-text">ÈªûÊìäÊàñÊãñÊîæÂúñÁâáÂà∞ÈÄôË£°</p>
          <p class="upload-hint">ÊîØÊè¥ JPG„ÄÅPNG Ê†ºÂºè</p>
        </div>
        <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)">
        <button class="cancel-upload-button" onclick="cancelUpload()">
          <span class="cancel-circle">‚úï</span>
          ÂèñÊ∂à
        </button>
      </div>

      <!-- ÁµêÊûúÈ°ØÁ§∫ -->
      <div class="result-section hidden" id="resultSection">
        <div class="image-preview-circle">
          <img id="previewImage" src="" alt="È†êË¶Ω">
        </div>

        <div class="loading-circle hidden" id="loadingSection">
          <div class="spinner"></div>
          <p>Ëæ®Ë≠ò‰∏≠...</p>
        </div>

        <div class="result-display hidden" id="resultDisplay"></div>

        <button class="reset-button" onclick="resetApp()">
          <span class="reset-circle">‚ü≤</span>
          ÈáçÊñ∞ÈÅ∏Êìá
        </button>
      </div>
    </div>
  </div>

  <script>
    // ÁãÄÊÖãÁÆ°ÁêÜ
    let currentStream = null;
    let selectedImageFile = null;

    // ÂàùÂßãÂåñÂúìÈªûËÉåÊôØ
    function initDots() {
      const dotsContainer = document.getElementById('dotsBackground');
      for (let i = 0; i < 20; i++) {
        const dot = document.createElement('div');
        dot.className = 'dot';
        dot.style.left = Math.random() * 100 + '%';
        dot.style.top = Math.random() * 100 + '%';
        dot.style.animationDelay = Math.random() * 2 + 's';
        dotsContainer.appendChild(dot);
      }
    }

    // È°ØÁ§∫/Èö±ËóèÂÖÉÁ¥†
    function show(element) {
      element.classList.remove('hidden');
    }

    function hide(element) {
      element.classList.add('hidden');
    }

    // ÊâìÈñãÊãçÁÖßÁïåÈù¢
    async function openCamera() {
      hide(document.getElementById('modeSelector'));
      show(document.getElementById('cameraSection'));
      
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { 
            facingMode: 'environment',
            width: { ideal: 1920 },
            height: { ideal: 1080 }
          }
        });
        currentStream = stream;
        const video = document.getElementById('videoElement');
        video.srcObject = stream;
        
        // Èö±ËóèÈåØË™§Ë®äÊÅØÔºàÂ¶ÇÊûúÊúâÁöÑË©±Ôºâ
        const errorDiv = document.querySelector('.error-message');
        if (errorDiv) {
          errorDiv.remove();
        }
      } catch (error) {
        console.error('ÁÑ°Ê≥ïÂ≠òÂèñÊîùÂÉèÈ†≠:', error);
        showCameraError('ÁÑ°Ê≥ïÂ≠òÂèñÊîùÂÉèÈ†≠ÔºåË´ãÊ™¢Êü•Ê¨äÈôêË®≠ÂÆö');
      }
    }

    // È°ØÁ§∫ÊîùÂÉèÈ†≠ÈåØË™§
    function showCameraError(message) {
      const cameraFrame = document.getElementById('cameraFrame');
      cameraFrame.innerHTML = `
        <div class="error-message">
          <div class="error-circle">‚ö†Ô∏è</div>
          <p>${message}</p>
          <button class="cancel-button" onclick="cancelCamera()">ËøîÂõû</button>
        </div>
      `;
    }

    // ÂèñÊ∂àÊãçÁÖß
    function cancelCamera() {
      stopCamera();
      hide(document.getElementById('cameraSection'));
      show(document.getElementById('modeSelector'));
    }

    // ÂÅúÊ≠¢ÊîùÂÉèÈ†≠
    function stopCamera() {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
        currentStream = null;
      }
      const video = document.getElementById('videoElement');
      if (video) {
        video.srcObject = null;
      }
    }

    // ÊãçÁÖß
    function capturePhoto() {
      const video = document.getElementById('videoElement');
      const canvas = document.getElementById('canvasElement');
      
      if (!video || !canvas) return;

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      const context = canvas.getContext('2d');
      
      // Áπ™Ë£ΩÂà∞ÂúìÂΩ¢ÂçÄÂüü
      context.save();
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(canvas.width, canvas.height) / 2;

      context.beginPath();
      context.arc(centerX, centerY, radius, 0, 2 * Math.PI);
      context.clip();

      // Á∏ÆÊîæ‰∏¶Â±Ö‰∏≠Áπ™Ë£Ω
      const scale = Math.max(canvas.width / video.videoWidth, canvas.height / video.videoHeight);
      const x = (canvas.width - video.videoWidth * scale) / 2;
      const y = (canvas.height - video.videoHeight * scale) / 2;

      context.drawImage(video, x, y, video.videoWidth * scale, video.videoHeight * scale);
      context.restore();

      canvas.toBlob((blob) => {
        if (blob) {
          const file = new File([blob], 'capture.jpg', { type: 'image/jpeg' });
          handleImageFile(file);
        }
      }, 'image/jpeg', 0.9);
    }

    // ÊâìÈñã‰∏äÂÇ≥ÁïåÈù¢
    function openUpload() {
      hide(document.getElementById('modeSelector'));
      show(document.getElementById('uploadSection'));
    }

    // ÂèñÊ∂à‰∏äÂÇ≥
    function cancelUpload() {
      hide(document.getElementById('uploadSection'));
      show(document.getElementById('modeSelector'));
    }

    // ËôïÁêÜÊñá‰ª∂ÈÅ∏Êìá
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file && file.type.startsWith('image/')) {
        handleImageFile(file);
      }
    }

    // ËôïÁêÜÊãñÊîæ
    function handleDrop(event) {
      event.preventDefault();
      event.stopPropagation();
      const uploadArea = document.getElementById('uploadArea');
      uploadArea.classList.remove('dragover');
      
      const file = event.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        handleImageFile(file);
      }
    }

    function handleDragOver(event) {
      event.preventDefault();
      event.stopPropagation();
      const uploadArea = document.getElementById('uploadArea');
      uploadArea.classList.add('dragover');
    }

    function handleDragLeave(event) {
      event.preventDefault();
      event.stopPropagation();
      const uploadArea = document.getElementById('uploadArea');
      uploadArea.classList.remove('dragover');
    }

    // ËôïÁêÜÂúñÁâáÊñá‰ª∂
    async function handleImageFile(file) {
      selectedImageFile = file;
      const imageUrl = URL.createObjectURL(file);
      
      // ÂÅúÊ≠¢ÊîùÂÉèÈ†≠
      stopCamera();
      
      // Èö±ËóèÂÖ∂‰ªñÁïåÈù¢
      hide(document.getElementById('modeSelector'));
      hide(document.getElementById('cameraSection'));
      hide(document.getElementById('uploadSection'));
      
      // È°ØÁ§∫ÁµêÊûúÁïåÈù¢
      show(document.getElementById('resultSection'));
      document.getElementById('previewImage').src = imageUrl;
      
      // Èö±ËóèÁµêÊûúÔºåÈ°ØÁ§∫ËºâÂÖ•
      hide(document.getElementById('resultDisplay'));
      show(document.getElementById('loadingSection'));

      try {
        const result = await classifyImage(file);
        displayResult(result);
      } catch (error) {
        console.error('Ëæ®Ë≠òÈåØË™§:', error);
        displayResult({
          prediction: 'ÈåØË™§',
          confidence: 0,
          error: error.message || 'Ëæ®Ë≠òÂ§±ÊïóÔºåË´ãÈáçË©¶'
        });
      } finally {
        hide(document.getElementById('loadingSection'));
      }
    }

    // API Ë™øÁî®
    async function classifyImage(imageFile) {
      const API_URL = 'https://api.kaggle.com/v1/models/my-first-project-e5dsa/1/predict';
      
      try {
        const formData = new FormData();
        formData.append('image', imageFile);

        const response = await fetch(API_URL, {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          throw new Error(`APIË´ãÊ±ÇÂ§±Êïó: ${response.status}`);
        }

        const data = await response.json();
        
        return {
          prediction: data.prediction || data.class || 'Êú™Áü•',
          confidence: data.confidence || data.score || 0.5
        };
      } catch (error) {
        // Â¶ÇÊûúAPI‰∏çÂèØÁî®Ôºå‰ΩøÁî®Ê®°Êì¨Êï∏Êìö
        console.warn('APIË™øÁî®Â§±ÊïóÔºå‰ΩøÁî®Ê®°Êì¨Êï∏Êìö:', error.message);
        return simulateClassification(imageFile);
      }
    }

    // Ê®°Êì¨ÂàÜÈ°ûÔºàÁî®ÊñºÊ∏¨Ë©¶Ôºâ
    function simulateClassification(imageFile) {
      const fileName = imageFile.name.toLowerCase();
      
      let prediction = 'Êú™Áü•';
      let confidence = 0.5;

      if (fileName.includes('bagel') || fileName.includes('Ë≤ùÊûú')) {
        prediction = 'Ë≤ùÊûú';
        confidence = 0.85 + Math.random() * 0.1;
      } else if (fileName.includes('donut') || fileName.includes('ÁîúÁîúÂúà')) {
        prediction = 'ÁîúÁîúÂúà';
        confidence = 0.85 + Math.random() * 0.1;
      } else {
        prediction = Math.random() > 0.5 ? 'Ë≤ùÊûú' : 'ÁîúÁîúÂúà';
        confidence = 0.7 + Math.random() * 0.2;
      }

      return {
        prediction,
        confidence
      };
    }

    // È°ØÁ§∫ÁµêÊûú
    function displayResult(result) {
      const resultDisplay = document.getElementById('resultDisplay');
      
      if (result.error) {
        resultDisplay.innerHTML = `
          <div class="result-display error-result">
            <div class="result-circle result-error-circle">
              <span>‚ö†Ô∏è</span>
            </div>
            <p class="result-message">${result.error}</p>
          </div>
        `;
      } else {
        const isBagel = result.prediction === 'Ë≤ùÊûú' || result.prediction.toLowerCase().includes('bagel');
        const isDonut = result.prediction === 'ÁîúÁîúÂúà' || result.prediction.toLowerCase().includes('donut');
        const confidence = Math.round(result.confidence * 100);
        const emoji = isBagel ? 'ü•Ø' : isDonut ? 'üç©' : '‚ùì';
        const title = isBagel ? 'ÈÄôÊòØË≤ùÊûúÔºÅ' : isDonut ? 'ÈÄôÊòØÁîúÁîúÂúàÔºÅ' : result.prediction;
        const resultClass = isBagel ? 'bagel-result' : isDonut ? 'donut-result' : '';

        resultDisplay.innerHTML = `
          <div class="result-display">
            <div class="result-circle ${resultClass}">
              <div class="result-emoji">${emoji}</div>
            </div>
            <div class="result-info">
              <h2 class="result-title">${title}</h2>
              <div class="confidence-bar">
                <div class="confidence-label">‰ø°ÂøÉÂ∫¶</div>
                <div class="confidence-circle-container">
                  <div class="confidence-circle" style="background: conic-gradient(from 0deg, rgba(255, 255, 255, 0.4) 0deg, rgba(255, 255, 255, 0.4) ${confidence * 3.6}deg, rgba(255, 255, 255, 0.1) ${confidence * 3.6}deg, rgba(255, 255, 255, 0.1) 360deg);">
                    <span>${confidence}%</span>
                  </div>
                </div>
              </div>
              <div class="result-details">
                <div class="detail-dot"></div>
                <span>È†êÊ∏¨È°ûÂà•: ${result.prediction}</span>
              </div>
            </div>
          </div>
        `;
      }
      
      show(resultDisplay);
    }

    // ÈáçÁΩÆÊáâÁî®
    function resetApp() {
      stopCamera();
      selectedImageFile = null;
      
      hide(document.getElementById('resultSection'));
      hide(document.getElementById('cameraSection'));
      hide(document.getElementById('uploadSection'));
      show(document.getElementById('modeSelector'));
      
      document.getElementById('previewImage').src = '';
      document.getElementById('fileInput').value = '';
    }

    // ÂàùÂßãÂåñ
    initDots();
  </script>
</body>
</html>
